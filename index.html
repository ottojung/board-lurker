
<head>
  <meta charset="utf-8">
  <meta name="robots" content="noarchive">
  <meta name="keywords" content="imageboard,anonymous,random,memes,have,Desi">
  <meta name="referrer" content="origin">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="shortcut icon" href="https://s.4cdn.org/image/favicon.ico">
  <link rel="stylesheet" title="switch" href="https://s.4cdn.org/css/yotsubanew.704.css">
  <link rel="alternate stylesheet" style="text/css" href="https://s.4cdn.org/css/yotsubanew.704.css" title="Yotsuba New">
  <link rel="alternate stylesheet" style="text/css" href="https://s.4cdn.org/css/yotsubluenew.704.css" title="Yotsuba B New">
  <link rel="alternate stylesheet" style="text/css" href="https://s.4cdn.org/css/futabanew.704.css" title="Futaba New">
  <link rel="alternate stylesheet" style="text/css" href="https://s.4cdn.org/css/burichannew.704.css" title="Burichan New">
  <link rel="alternate stylesheet" style="text/css" href="https://s.4cdn.org/css/photon.704.css" title="Photon">
  <link rel="alternate stylesheet" style="text/css" href="https://s.4cdn.org/css/tomorrow.704.css" title="Tomorrow">
  <link rel="stylesheet" href="https://s.4cdn.org/css/yotsubamobile.704.css">
  <link rel="canonical" href="http://boards.4chan.org/b/thread/875428042/why-dont-you-have-a-desi-gf">
  <link rel="alternate" title="RSS feed" href="/b/index.rss" type="application/rss+xml">
  <title>KEK</title>
  <script>

    async function get_threads(board) {
        var response = await fetch("https://a.4cdn.org/" + board + "/threads.json");
        var json = await response.json();

        var joined = [];

        for (var i = 0; i < json.length; i++) {
            var threads = json[i].threads;
            for (var k = 0; k < threads.length; k++) {
                joined.push(threads[k]);
            }
        }

        return joined;
    }

    async function get_thread_posts(board, thread_id) {
        var response = await fetch("https://a.4cdn.org/" + board + "/thread/" + thread_id.toString() + ".json");
        var json = await response.json();
        return json.posts;
    }

    async function get_popular_b_threads() {
        var threads = await get_threads("b");
        var popular = threads.filter(thread => thread.replies > 200);
        return popular;
    }

    function make_posts_obs(posts) {
        var ret = {};
        for (var i = 0; i < posts.length; i++) {
            var p = posts[i];
            p.my_index = i;
            p.my_replies_count = 0;
            ret[p.no] = p;
        }
        return ret;
    }

    var thread_div = null;
    function get_thread_div() {
        if (thread_div == null) {
            thread_div = document.getElementsByClassName("thread")[0];
        }
        return thread_div;
    }

    function get_post_link(board, thread_id, post_id) {
        switch (board) {
        case "b":
        case "bant":
            return `https://thebarchive.com/${board.toString()}/thread/${thread_id.toString()}/#p${post_id.toString()}"`;
        case "pol":
        case "adv":
        case "f":
        case "hr":
        case "o":
        case "pol":
        case "s4s":
        case "sp":
        case "tg":
        case "trv":
        case "tv":
        case "x":
            return `https://4plebs.org/${board.toString()}/thread/${thread_id.toString()}/#p${post_id.toString()}"`;
        default:
            return `no board "/${board}/" archives`;
        }
    }

    function append_html_to_thread_div(html) {
        var div = get_thread_div();
        div.innerHTML += html;
    }

    function append_delimiter_to_thread_div() {
        append_html_to_thread_div("</br><hr></br>");
    }

    function display_post(op_q, board, thread_id, post) {
        console.log({post});
        var link = get_post_link(board, thread_id, post.no);
        append_html_to_thread_div(`
<div class="postContainer ${op_q ? 'opContainter' : 'replyContainer'}">
  <div class="sideArrows"></div>
    <div class="post reply">
      <div class="postInfo desktop">
        <span class="nameBlock">
          <span class="name"> ${post.name} </span>
        </span>
        <span class="dateTime">${post.now}</span>
        <span class="postNum desktop">
          <a href="${link}" title="Link to this post">No.</a>
          <a href="javascript:quote('${post.no.toString()}');">${post.no.toString()}</a>
        </span>
      </div>

      <div class="file">
        <div class="fileText">
          File: <a href="https://i.4cdn.org/b/${post.tim}${post.ext}" target="_blank">${post.filename}${post.ext}</a>
        </div>
        <a class="fileThumb" href="https://i.4cdn.org/b/${post.tim}${post.ext}" target="_blank">
          <img src="https://i.4cdn.org/b/${post.tim}s.jpg" alt="" data-md5="" style="" loading="lazy">
        </a>
      </div>

      <div> ${post.com.toString()} </div>
    </div>
  </div>
</div>`);
    }

    function display_op_post(board, thread_id, post) {
        display_post(true, board, thread_id, post);
    }

    function display_reply_post(board, thread_id, post) {
        display_post(false, board, thread_id, post);
    }

    function rank_posts_obj(obj) {
        for (const [key, value] of Object.entries(obj)) {
            var resto = value.resto;
            if (resto && resto > 0) {
                obj[resto].my_replies_count += 1;
            }
        }
    }

    var replies_to_display = 5;

    function display_posts(board, thread, posts) {
        var obj = make_posts_obs(posts);
        rank_posts_obj(obj);
        var sorted = Object.entries(obj).map(([k, v]) => v).sort((a, b) => a.my_replies_count < b.my_replies_count);
        var to_display = sorted.slice(1, replies_to_display);
        for (const post of to_display) {
            display_reply_post(board, thread.no, post);
        }
    }

    async function display_thread(board, thread) {
        display_op_post(board, thread.no, thread.posts[0]);
        display_posts(board, thread, thread.posts);
        append_delimiter_to_thread_div();
    }

    var all_threads = {};

    async function main_loop() {
        var current = await get_popular_b_threads();
        var any_new = false;
        for (const thread of current) {
            if (!all_threads[thread.no]) {
                thread.posts = await get_thread_posts("b", thread.no);
                all_threads[thread.no] = thread;
                any_new = true;
            }
        }

        if (any_new) {
            var threads = Object.entries(all_threads).map(([k, v]) => v).sort((a, b) => a.posts[0].time < b.posts[0].time).reverse();
            for (const thread of threads) {
                display_thread("b", thread);
            }
        }
    }

    function main() {
        main_loop().then(_ => setTimeout(main, 1000));
    }

    main();

  </script>
</head>

<body class="is_thread board_b yotsuba_new nws">
  <form name="delform" id="delform">
    <div class="board">
      <div class="thread">

      </div>
    </div>
  </form>
</body>
